<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tank Shooter</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="assets/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/lib/jQuery/css/jquery-ui.min.css" rel="stylesheet">
    <link href="assets/lib/normalizer_css/normalize.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <style>

    </style>
</head>
<body>

    <!--<section class="first-frame">
        <div class="start-content">
            <h2 class="card-header font-monospace">
                Shoot Blaster <img src="assets/img/tankLogo.png" style="width: 4vw">
            </h2>
            <div class="form-group ms-5 me-3">
                <label for="txtName">Player Name</label>
                <input type="email" class="form-control" id="txtName" placeholder="Player Name">
                <small id="fontName" class="form-text text-muted">Enter a name before start a game</small>
            </div>
            <div class="form-group ms-5 me-3">
                <label for="txtEmail">Email address</label>
                <input type="email" class="form-control" id="txtEmail" placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
            </div>
            <div class="form-group ms-5 me-3 mt-3">
                <select class="form-control">
                    <option>Slow</option>
                    <option>Medium</option>
                    <option>Fast</option>
                </select>

                <button type="button" class="btn btn-outline-danger mt-5">Cancel</button>

                <button type="button" id="btnStartGame" class="btn btn-outline-warning ms-4 mt-5">Start Game</button>
            </div>
        </div>
        <div class="alter-details">
           <img src="assets/img/tankX4.jpg" width=520px" height="320px">
        </div>
    </section>-->

    <section class="timer">
        <main id="countdown"></main>
    </section>

    <section class="main-content">
        <img id="backgr1" src="assets/img/backgr1.jpg">
        <div class="menu-buttons">
            <button id="btnStartAction" class="btn-success top-50">Start Me</button>
        </div>

        <img id="myTank" src="assets/img/tank2.png" alt="tank" style="display: none;">
        <canvas id="myTank-Area"></canvas>
    </section>

    <!--<section class="main-content">
        <img id="backgr1" src="assets/img/backgr1.jpg">
        <div class="colX">
            <div class="row1"></div>
            <div class="row2">
                <img id="myTank" src="assets/img/tank4.png">
            </div>
            <div class="row3"></div>
            <div class="row4"></div>
            <div class="row5"></div>
        </div>
        <div class="grid">
            <div class="row">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
            <div class="row">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
            </div>
            <div class="row">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
                <div class="col"></div>
            </div>
            <div class="row">
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                    <div class="fighter1">
                        <img src="assets/img/tank2.png" alt="tank">
                    </div>
                </div>
                <div class="col"></div>
            </div>
        </div>
        <div class="menu-buttons">
            <button id="btnStartAction" class="btn-success top-50">Start Me</button>
        </div>
    </section>-->

    <script src="assets/lib/jQuery/js/jquery-3.6.0.min.js"></script>
    <script src="assets/lib/jQuery/jquery.countdown360.min.js"></script>

    <script>

        /*===================================================*/

        var countdown = $("#countdown").countdown360({
            radius      : 110,
            seconds     : 5,
            fontColor   :'#FFFFFF',
            autostart   :false,
            onComplete  :function () {
                $("#countdown").css("display","none");
                $(".main-content").css("filter","none");
            }
        });

        $("#btnStartGame").click(function (){

            alert("Game will Start!! Press OK");

            $(".first-frame").fadeOut(2000);

            countdown.start();

        });

        /*================= Player Controller =======================*/

        class Player{

            constructor(x,y,pat, bulletController) {
                this.x=x;
                this.y=y;
                this.width=50;
                this.height=50;
                this.speed=4;
                this.bulletController = bulletController;
                this.pat=pat;

                document.addEventListener("keydown", this.keydown);
                document.addEventListener("keyup", this.keyup);
            }

            draw(ctx){
                this.move();
                ctx.drawImage(img,this.x,this.y,40,90);
                /*ctx.strokeStyle="yellow";
                ctx.fillStyle="black";
                ctx.strokeRect(this.x, this.y, this.width, this.height);
                ctx.fillRect(this.x, this.y, this.width, this.height);*/

                this.shoot();
            }

            shoot(){
                if(this.shootPressed){
                    console.log("Shoot....");
                    let speed = 5;
                    let delay = 7;
                    let damage = 1;
                    let bulletY = this.y + this.height - 10;
                    let bulletX = this.x + 30;
                    this.bulletController.shoot(bulletX,bulletY,speed,damage,delay);
                }
            }

            move() {
                /*console.log(" inner height " + window.innerHeight)*/

                if((this.y > 0 && this.y < 521)){
                    if (this.downPressed) {
                        this.y += this.speed;
                    }
                    if (this.upPressed) {
                        this.y -= this.speed;
                    }
                }else{
                    if(this.y < 0){
                        this.y = 0;
                    }
                    if(this.y > 521){
                        this.y = 521;
                    }

                    if (this.downPressed) {
                        this.y += this.speed;
                    }
                    if (this.upPressed) {
                        this.y -= this.speed;
                    }
                }

                /*console.log(" y: " + this.y);
                console.log(" x: " + this.x);
                */

                if((this.x > 0 && this.x < 450)){
                    if (this.leftPressed) {
                        this.x -= this.speed;
                    }
                    if (this.rightPressed) {
                        this.x += this.speed;
                    }
                }else{
                   if(this.x < 0){
                       this.x=0;
                   }
                   if(this.x > 450){
                       this.x=450;
                   }
                    if (this.leftPressed) {
                        this.x -= this.speed;
                    }
                    if (this.rightPressed) {
                        this.x += this.speed;
                    }
                }
            }

            keydown = (e) => {
                if (e.code === "ArrowUp") {
                    this.upPressed = true;
                }
                if (e.code === "ArrowDown") {
                    this.downPressed = true;
                }
                if (e.code === "ArrowLeft") {
                    this.leftPressed = true;
                }
                if (e.code === "ArrowRight") {
                    this.rightPressed = true;
                }
                if(e.code === "Space"){
                    this.shootPressed= true;
                }
            };

            keyup = (e) => {
                if (e.code === "ArrowUp") {
                    this.upPressed = false;
                }
                if (e.code === "ArrowDown") {
                    this.downPressed = false;
                }
                if (e.code === "ArrowLeft") {
                    this.leftPressed = false;
                }
                if (e.code === "ArrowRight") {
                    this.rightPressed = false;
                }
                if(e.code === "Space"){
                    this.shootPressed= false;
                }
            };
        }

        /*==================== Bullet JS ==============================*/

        class Bullet{
            constructor(x,y,speed,damage) {
                this.x=x;
                this.y=y;
                this.speed=speed;
                this.damage=damage;

                this.width =5;
                this.height=15;
                this.color="red";
            }

            draw(ctx){
                ctx.fillStyle = this.color;
                this.x += this.speed;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        /*============== Bullet Controller ===============================*/

        class BulletController{

            bullets = [];
            timeTillNextBullet=0;

            constructor(canvas) {
                this.canvas = canvas;
            }

            shoot(x,y,speed,damage,delay){
                if(this.timeTillNextBullet <=0){
                    this.bullets.push(new Bullet(x,y,speed,damage));
                    this.timeTillNextBullet = delay;
                }

                this.timeTillNextBullet--;
            }

            isBulletOffScreen(bullet){
                return bullet.y <= -bullet.height;
            }

            draw(ctx){
                this.bullets.forEach((bullet) => bullet.draw(ctx));
            }
        }


        /*==================== Main Controller ========================*/

        const canvas = document.getElementById("myTank-Area");
        const img = document.getElementById("myTank");
        const ctx = canvas.getContext("2d");

        canvas.width = 550;
        canvas.height = 600;

        const bulletController = new BulletController(canvas);
        const player = new Player(canvas.width/2.2, canvas.height/1.3,img,bulletController);

        function gameLoop() {
            /*ctx.fillStyle = "black";
            ctx.fillStyle = "transparent";
            ctx.fillRect(0, 0, canvas.width, canvas.height);*/
            /*ctx.fillRect(0, 0, canvas.width, canvas.height);*/
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            player.draw(ctx);
            bulletController.draw(ctx);
        }

        function setCommonStyle(){
            ctx.shadowColor= "#d53";
            ctx.lineJoin="bevel";
        }

        setInterval(gameLoop, 1000 / 60);

    </script>
</body>
</html>